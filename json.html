<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Корзина товаров</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>

    <header>
  <h1>Наши товары</h1>
  <nav>
    <!-- Навигация по страницам -->
    <a href="index.html">Главная</a>
    <a href="about.html">О нас</a>
    <a href="jokes.html">Ваши шутки</a>
    <a href="game.html">Супер-игра</a>
   <a href="video.html">Видео</a>
   <a href="lessons.html">Занятия</a>
  </nav>
</header>

<div class="cart-box"></div>

<div class="cart-section">
  <h2>Товары в корзине</h2>
  <div class="cart-items"></div>
  <div class="total-price"></div>
</div>

<script src="data.js"></script>
<script>
const data = JSON.parse(dataProducts);
const cartBox = document.querySelector('.cart-box');
const cartItemsContainer = document.querySelector('.cart-items');
const cartSection = document.querySelector('.cart-section');
const totalPriceEl = document.querySelector('.total-price');

const cartItems = [];

// Функция для преобразования цены в число
function parsePrice(priceString) {
    // Убираем символ $ и пробелы, затем преобразуем в число
    return parseFloat(priceString.replace('$', '').trim());
}

// Создаем блоки товаров для добавления
data.forEach(element => {
  const itemEl = document.createElement('div');
  itemEl.className = 'item';

  const itemImg = document.createElement('img');
  itemImg.src = element.url;

  const itemName = document.createElement('h3');
  itemName.textContent = element.name;

  const itemPrice = document.createElement('div');
  itemPrice.className = 'price';
  const cleanPrice = parsePrice(element.price);
  itemPrice.textContent = `Цена: ${element.price}`; // Оставляем оригинальное отображение
  itemPrice.dataset.price = cleanPrice; // сохраняем чистую цену как число

  // Контроль количества
  const quantityControls = document.createElement('div');
  quantityControls.className = 'quantity-controls';

  const btnMinus = document.createElement('button');
  btnMinus.textContent = '-';

  const quantityInput = document.createElement('input');
  quantityInput.type = 'number';
  quantityInput.value = 1;
  quantityInput.min = 1;
  quantityInput.style.width = '50px';

  const btnPlus = document.createElement('button');
  btnPlus.textContent = '+';

  quantityControls.appendChild(btnMinus);
  quantityControls.appendChild(quantityInput);
  quantityControls.appendChild(btnPlus);

  const addButton = document.createElement('button');
  addButton.className = 'add-to-cart';
  addButton.textContent = 'Добавить в корзину';

  // Собираем товар
  cartBox.appendChild(itemEl);
  itemEl.appendChild(itemImg);
  itemEl.appendChild(itemName);
  itemEl.appendChild(itemPrice);
  itemEl.appendChild(quantityControls);
  itemEl.appendChild(addButton);

  // Обработчики для + и -
  btnMinus.addEventListener('click', () => {
    if (parseInt(quantityInput.value) > 1) {
      quantityInput.value = parseInt(quantityInput.value) - 1;
    }
  });
  
  btnPlus.addEventListener('click', () => {
    quantityInput.value = parseInt(quantityInput.value) + 1;
  });

  // Обработчик добавления
  addButton.addEventListener('click', () => {
    const quantity = parseInt(quantityInput.value);
    const price = parseFloat(itemPrice.dataset.price);
    
    // Ищем товар в корзине
    const existingIndex = cartItems.findIndex(ci => ci.name === element.name);
    
    if (existingIndex !== -1) {
      // Если товар уже есть, увеличиваем количество
      cartItems[existingIndex].quantity += quantity;
    } else {
      // Новый товар
      cartItems.push({
        id: element.name, // используем name как ID, так как в данных нет id
        name: element.name,
        url: element.url,
        price: price,
        quantity: quantity
      });
    }
    updateCart();
  });
});

function updateCart() {
  cartItemsContainer.innerHTML = '';

  if (cartItems.length === 0) {
    cartSection.style.display = 'none';
    return;
  }
  
  cartSection.style.display = 'block';

  let totalSum = 0;

  cartItems.forEach((item, index) => {
    const cartItemEl = document.createElement('div');
    cartItemEl.className = 'cart-item';

    const img = document.createElement('img');
    img.src = item.url;

    const detailsDiv = document.createElement('div');
    detailsDiv.className = 'cart-item-details';

    const nameEl = document.createElement('p');
    nameEl.textContent = item.name;

    const infoEl = document.createElement('p');
    const sum = item.price * item.quantity;
    totalSum += sum;
    
    infoEl.textContent = `Цена: $${item.price} × ${item.quantity} = $${sum.toFixed(2)}`;

    // Кнопка удаления
    const removeBtn = document.createElement('button');
    removeBtn.className = 'remove-btn';
    removeBtn.textContent = 'Удалить';

    removeBtn.addEventListener('click', () => {
      cartItems.splice(index, 1);
      updateCart();
    });

    // Обновление количества
    const quantityControl = document.createElement('div');
    quantityControl.style.display = 'flex';
    quantityControl.style.alignItems = 'center';
    quantityControl.style.marginTop = '4px';
    quantityControl.style.justifyContent = 'center';
    quantityControl.style.gap = '10px';

    const minusBtn = document.createElement('button');
    minusBtn.textContent = '-';
    minusBtn.style.padding = '5px 10px';

    const qtySpan = document.createElement('span');
    qtySpan.textContent = `Кол-во: ${item.quantity}`;
    qtySpan.style.minWidth = '80px';
    qtySpan.style.textAlign = 'center';

    const plusBtn = document.createElement('button');
    plusBtn.textContent = '+';
    plusBtn.style.padding = '5px 10px';

    minusBtn.addEventListener('click', () => {
      if (item.quantity > 1) {
        item.quantity--;
        updateCart();
      }
    });
    
    plusBtn.addEventListener('click', () => {
      item.quantity++;
      updateCart();
    });

    quantityControl.appendChild(minusBtn);
    quantityControl.appendChild(qtySpan);
    quantityControl.appendChild(plusBtn);

    detailsDiv.appendChild(nameEl);
    detailsDiv.appendChild(infoEl);
    detailsDiv.appendChild(quantityControl);
    detailsDiv.appendChild(removeBtn);

    cartItemEl.appendChild(img);
    cartItemEl.appendChild(detailsDiv);

    cartItemsContainer.appendChild(cartItemEl);
  });

  totalPriceEl.textContent = `Общая сумма: $${totalSum.toFixed(2)}`;
}

// Инициализация
updateCart();
</script>

<footer>
  <p>&copy; 2025 Юмор IT-компании</p>
</footer>

</body>
</html>
